import{Array as e,Map as t,transact as n}from"yjs";import{getDiff as r}from"recursive-diff";var o,i="YJS_INCOMING_CHANGES",a=function(e){return"[object Object]"===Object.prototype.toString.call(e)},f=function(e){return Array.isArray(e)},c=function(e){return"string"==typeof e||e instanceof String},s=function(e){return Number.isInteger(e)},u=function n(r){if(f(r)){var o=new e,i=r.map(function(e){return n(e)});return o.push(i),o}if(a(r)){var c=new t;return Object.entries(r).forEach(function(e){c.set(e[0],n(e[1]))}),c}return r};!function(e){e.Add="add",e.Update="update",e.Delete="delete"}(o||(o={}));var d=function n(r,i,a,f){if(0===a.length)throw new Error("Cannot traverse 0 length path.");if(1===a.length)!function(n,r,i,a){if(r===o.Add||r===o.Update){var f=u(a);if(n instanceof e&&s(i))r===o.Update&&n.delete(i),n.insert(i,[f]);else{if(!(n instanceof t&&c(i)))throw new Error("Unsupported YAbstractType or property type did not match.");n.set(i,f)}}else if(r===o.Delete)if(n instanceof e&&s(i)){var d=(l=n.length-1,(p=i)<0?0:p>l?l:p);n.delete(d)}else{if(!(n instanceof t&&c(i)))throw new Error("Unsupported YAbstractType or property type did not match.");n.delete(i)}var p,l}(r,i,a[0],f);else{var d=a[0],p=a.slice(1);if(r instanceof e){if(!s(d))throw new Error("States diverged.");var l=r.get(d);if(!(l instanceof t||l instanceof e))throw new Error("States diverged.");n(l,i,p,f)}else if(r instanceof t){if(!c(d))throw new Error("States diverged.");var v=r.get(d);if(!(v instanceof t||v instanceof e))throw new Error("States diverged.");n(v,i,p,f)}else console.warn("Encountered unsupported yType. Received:",r)}},p=function(e,t,n,o){r(n,o).forEach(function(n){var r=n.val;d(e,n.op,[t].concat(n.path||[]),r)})},l="__ReduxYjsBindingsRootMap",v=function(e,t,r){var o=e.getMap("__ReduxYjsBindingsRootMap"),i=t.getState()[r];a(i)&&n(e,function(){o.set(r,u({})),p(o,r,{},i)}),f(i)&&n(e,function(){o.set(r,u([])),p(o,r,[],i)});var c=!1,s=!1,d=t.getState()[r],l=t.subscribe(function(){var i=d;d=t.getState()[r],s||(c=!0,n(e,function(){p(o,r,i,d)}),c=!1)}),v=function(){c||(s=!0,function(e,t,n){e.dispatch({type:"YJS_INCOMING_CHANGES",payload:t.toJSON()[n]})}(t,o,r),s=!1)};return o.observeDeep(v),function(){l(),o.unobserveDeep(v)}},g=function(e){return function(t,n){return"YJS_INCOMING_CHANGES"===(null==n?void 0:n.type)?void 0===n.payload?t:n.payload:e(t,n)}};export{l as ROOT_MAP_NAME,i as SET_STATE_FROM_YJS_ACTION,v as bind,g as enhanceReducer};
//# sourceMappingURL=bindings.module.js.map
