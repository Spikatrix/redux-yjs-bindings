var e,t=require("yjs"),r=require("recursive-diff"),n=function(e){return"[object Object]"===Object.prototype.toString.call(e)},o=function(e){return Array.isArray(e)},a=function(e){return"string"==typeof e||e instanceof String},i=function(e){return Number.isInteger(e)},c=function e(r){if(o(r)){var a=new t.Array,i=r.map(function(t){return e(t)});return a.push(i),a}if(n(r)){var c=new t.Map;return Object.entries(r).forEach(function(t){c.set(t[0],e(t[1]))}),c}return r};!function(e){e.Add="add",e.Update="update",e.Delete="delete"}(e||(e={}));var s=function r(n,o,s,f){if(0===s.length)throw new Error("Cannot traverse 0 length path.");if(1===s.length)!function(r,n,o,s){if(n===e.Add||n===e.Update){var f=c(s);if(r instanceof t.Array&&i(o))n===e.Update&&r.delete(o),r.insert(o,[f]);else{if(!(r instanceof t.Map&&a(o)))throw new Error("Unsupported YAbstractType or property type did not match.");r.set(o,f)}}else if(n===e.Delete)if(r instanceof t.Array&&i(o)){var u=(d=r.length-1,(p=o)<0?0:p>d?d:p);r.delete(u)}else{if(!(r instanceof t.Map&&a(o)))throw new Error("Unsupported YAbstractType or property type did not match.");r.delete(o)}var p,d}(n,o,s[0],f);else{var u=s[0],p=s.slice(1);if(n instanceof t.Array){if(!i(u))throw new Error("States diverged.");var d=n.get(u);if(!(d instanceof t.Map||d instanceof t.Array))throw new Error("States diverged.");r(d,o,p,f)}else if(n instanceof t.Map){if(!a(u))throw new Error("States diverged.");var l=n.get(u);if(!(l instanceof t.Map||l instanceof t.Array))throw new Error("States diverged.");r(l,o,p,f)}else console.warn("Encountered unsupported yType. Received:",n)}},f=function(e,t,n,o){r.getDiff(n,o).forEach(function(r){var n=r.val;s(e,r.op,[t].concat(r.path||[]),n)})};exports.ROOT_MAP_NAME="__ReduxYjsBindingsRootMap",exports.SET_STATE_FROM_YJS_ACTION="YJS_INCOMING_CHANGES",exports.bind=function(e,r,a){var i=e.getMap("__ReduxYjsBindingsRootMap"),s=r.getState()[a];n(s)&&t.transact(e,function(){i.set(a,c({})),f(i,a,{},s)}),o(s)&&t.transact(e,function(){i.set(a,c([])),f(i,a,[],s)});var u=!1,p=!1,d=r.getState()[a],l=r.subscribe(function(){var n=d;d=r.getState()[a],p||(u=!0,t.transact(e,function(){f(i,a,n,d)}),u=!1)}),v=function(){u||(p=!0,function(e,t,r){e.dispatch({type:"YJS_INCOMING_CHANGES",payload:t.toJSON()[r]})}(r,i,a),p=!1)};return i.observeDeep(v),function(){l(),i.unobserveDeep(v)}},exports.enhanceReducer=function(e){return function(t,r){return"YJS_INCOMING_CHANGES"===(null==r?void 0:r.type)?void 0===r.payload?t:r.payload:e(t,r)}};
//# sourceMappingURL=bindings.cjs.map
