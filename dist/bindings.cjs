var e,t=require("yjs"),r=require("recursive-diff"),n=function(e){return"[object Object]"===Object.prototype.toString.call(e)},a=function(e){return Array.isArray(e)},o=function(e){return"string"==typeof e||e instanceof String},i=function(e){return Number.isInteger(e)},c=function e(r){if(a(r)){var o=new t.Array,i=r.map(function(t){return e(t)});return o.push(i),o}if(n(r)){var c=new t.Map;return Object.entries(r).forEach(function(t){c.set(t[0],e(t[1]))}),c}return r};!function(e){e.Add="add",e.Update="update",e.Delete="delete"}(e||(e={}));var s=function r(n,a,s,f){if(0===s.length)throw new Error("Cannot traverse 0 length path.");if(1===s.length)!function(r,n,a,s){if(n===e.Add||n===e.Update){var f=c(s);if(r instanceof t.Array&&i(a))n===e.Update&&r.delete(a),r.insert(a,[f]);else{if(!(r instanceof t.Map&&o(a)))throw new Error("Unsupported YAbstractType or property type did not match.");r.set(a,f)}}else if(n===e.Delete)if(r instanceof t.Array&&i(a)){var p=(d=r.length-1,(u=a)<0?0:u>d?d:u);r.delete(p)}else{if(!(r instanceof t.Map&&o(a)))throw new Error("Unsupported YAbstractType or property type did not match.");r.delete(a)}var u,d}(n,a,s[0],f);else{var p=s[0],u=s.slice(1);if(n instanceof t.Array){if(!i(p))throw new Error("States diverged.");var d=n.get(p);if(!(d instanceof t.Map||d instanceof t.Array))throw new Error("States diverged.");r(d,a,u,f)}else if(n instanceof t.Map){if(!o(p))throw new Error("States diverged.");var l=n.get(p);if(!(l instanceof t.Map||l instanceof t.Array))throw new Error("States diverged.");r(l,a,u,f)}else console.warn("Encountered unsupported yType. Received:",n)}},f=function(e,t,n,a){r.getDiff(n,a).forEach(function(r){var n=r.val;s(e,r.op,[t].concat(r.path||[]),n)})};exports.ROOT_MAP_NAME="__ReduxYjsBindingsRootMap",exports.SET_STATE_FROM_YJS_ACTION="YJS_INCOMING_CHANGES",exports.bind=function(e,r,o){var i=e.getMap("__ReduxYjsBindingsRootMap"),s=r.getState()[o];n(s)&&t.transact(e,function(){i.set(o,c({})),f(i,o,{},s)}),a(s)&&t.transact(e,function(){i.set(o,c([])),f(i,o,[],s)});var p=!1,u=!1,d=r.getState()[o];r.subscribe(function(){var n=d;d=r.getState()[o],u||(p=!0,t.transact(e,function(){f(i,o,n,d)}),p=!1)}),i.observeDeep(function(){p||(u=!0,function(e,t,r){e.dispatch({type:"YJS_INCOMING_CHANGES",payload:t.toJSON()[r]})}(r,i,o),u=!1)})},exports.enhanceReducer=function(e){return function(t,r){return"YJS_INCOMING_CHANGES"===(null==r?void 0:r.type)?void 0===r.payload?t:r.payload:e(t,r)}};
//# sourceMappingURL=bindings.cjs.map
