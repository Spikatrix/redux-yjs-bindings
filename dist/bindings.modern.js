import{Array as e,Map as t,transact as r}from"yjs";import{getDiff as o}from"recursive-diff";const n="YJS_INCOMING_CHANGES",s=e=>"[object Object]"===Object.prototype.toString.call(e),i=e=>Array.isArray(e),a=e=>"string"==typeof e||e instanceof String,d=e=>Number.isInteger(e),c=r=>{if(i(r)){const t=new e,o=r.map(e=>c(e));return t.push(o),t}if(s(r)){const e=new t;return Object.entries(r).forEach(([t,r])=>{e.set(t,c(r))}),e}return r};var p;!function(e){e.Add="add",e.Update="update",e.Delete="delete"}(p||(p={}));const f=(r,o,n,s)=>{if(0===n.length)throw new Error("Cannot traverse 0 length path.");if(1===n.length)((r,o,n,s)=>{if(o===p.Add||o===p.Update){const i=c(s);if(r instanceof e&&d(n))o===p.Update&&r.delete(n),r.insert(n,[i]);else{if(!(r instanceof t&&a(n)))throw new Error("Unsupported YAbstractType or property type did not match.");r.set(n,i)}}else if(o===p.Delete)if(r instanceof e&&d(n)){const e=(f=r.length-1,(i=n)<0?0:i>f?f:i);r.delete(e)}else{if(!(r instanceof t&&a(n)))throw new Error("Unsupported YAbstractType or property type did not match.");r.delete(n)}var i,f})(r,o,n[0],s);else{const[i,...c]=n;if(r instanceof e){if(!d(i))throw new Error("States diverged.");const n=r.get(i);if(!(n instanceof t||n instanceof e))throw new Error("States diverged.");f(n,o,c,s)}else if(r instanceof t){if(!a(i))throw new Error("States diverged.");const n=r.get(i);if(!(n instanceof t||n instanceof e))throw new Error("States diverged.");f(n,o,c,s)}else console.warn("Encountered unsupported yType. Received:",r)}},l=(e,t,r,n)=>{o(r,n).forEach(({op:r,path:o,val:n})=>{f(e,r,[t,...o||[]],n)})},g="__ReduxYjsBindingsRootMap",h=(e,t,o)=>{const n=e.getMap("__ReduxYjsBindingsRootMap"),a=t.getState()[o];s(a)&&r(e,()=>{n.set(o,c({})),l(n,o,{},a)}),i(a)&&r(e,()=>{n.set(o,c([])),l(n,o,[],a)});let d=!1,p=!1,f=t.getState()[o];t.subscribe(()=>{const s=f;f=t.getState()[o],p||(d=!0,r(e,()=>{l(n,o,s,f)}),d=!1)}),n.observeDeep(()=>{d||(p=!0,((e,t,r)=>{e.dispatch({type:"YJS_INCOMING_CHANGES",payload:t.toJSON()[r]})})(t,n,o),p=!1)})},y=e=>(t,r)=>"YJS_INCOMING_CHANGES"===(null==r?void 0:r.type)?void 0===r.payload?t:r.payload:e(t,r);export{g as ROOT_MAP_NAME,n as SET_STATE_FROM_YJS_ACTION,h as bind,y as enhanceReducer};
//# sourceMappingURL=bindings.modern.js.map
