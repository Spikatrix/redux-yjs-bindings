import{Array as e,Map as t,transact as r}from"yjs";import{getDiff as n}from"recursive-diff";const o="YJS_INCOMING_CHANGES",s=e=>"[object Object]"===Object.prototype.toString.call(e),i=e=>Array.isArray(e),a=e=>"string"==typeof e||e instanceof String,d=e=>Number.isInteger(e),c=r=>{if(i(r)){const t=new e,n=r.map(e=>c(e));return t.push(n),t}if(s(r)){const e=new t;return Object.entries(r).forEach(([t,r])=>{e.set(t,c(r))}),e}return r};var p;!function(e){e.Add="add",e.Update="update",e.Delete="delete"}(p||(p={}));const f=(r,n,o,s)=>{if(0===o.length)throw new Error("Cannot traverse 0 length path.");if(1===o.length)((r,n,o,s)=>{if(n===p.Add||n===p.Update){const i=c(s);if(r instanceof e&&d(o))n===p.Update&&r.delete(o),r.insert(o,[i]);else{if(!(r instanceof t&&a(o)))throw new Error("Unsupported YAbstractType or property type did not match.");r.set(o,i)}}else if(n===p.Delete)if(r instanceof e&&d(o)){const e=(f=r.length-1,(i=o)<0?0:i>f?f:i);r.delete(e)}else{if(!(r instanceof t&&a(o)))throw new Error("Unsupported YAbstractType or property type did not match.");r.delete(o)}var i,f})(r,n,o[0],s);else{const[i,...c]=o;if(r instanceof e){if(!d(i))throw new Error("States diverged.");const o=r.get(i);if(!(o instanceof t||o instanceof e))throw new Error("States diverged.");f(o,n,c,s)}else if(r instanceof t){if(!a(i))throw new Error("States diverged.");const o=r.get(i);if(!(o instanceof t||o instanceof e))throw new Error("States diverged.");f(o,n,c,s)}else console.warn("Encountered unsupported yType. Received:",r)}},l=(e,t,r,o)=>{n(r,o).forEach(({op:r,path:n,val:o})=>{f(e,r,[t,...n||[]],o)})},g="__ReduxYjsBindingsRootMap",h=(e,t,n)=>{const o=e.getMap("__ReduxYjsBindingsRootMap"),a=t.getState()[n];s(a)&&r(e,()=>{o.set(n,c({})),l(o,n,{},a)}),i(a)&&r(e,()=>{o.set(n,c([])),l(o,n,[],a)});let d=!1,p=!1,f=t.getState()[n];const g=t.subscribe(()=>{const s=f;f=t.getState()[n],p||(d=!0,r(e,()=>{l(o,n,s,f)}),d=!1)}),h=()=>{d||(p=!0,((e,t,r)=>{e.dispatch({type:"YJS_INCOMING_CHANGES",payload:t.toJSON()[r]})})(t,o,n),p=!1)};return o.observeDeep(h),()=>{g(),o.unobserveDeep(h)}},u=e=>(t,r)=>"YJS_INCOMING_CHANGES"===(null==r?void 0:r.type)?void 0===r.payload?t:r.payload:e(t,r);export{g as ROOT_MAP_NAME,o as SET_STATE_FROM_YJS_ACTION,h as bind,u as enhanceReducer};
//# sourceMappingURL=bindings.modern.js.map
